app.controller("navigationController",function(e,t,n,a,o){function r(t,n){var a=document.createElement("div");a.setAttribute("id","mapdirectionBtn"),a.style.backgroundColor="#493073",a.style.border="2px solid #493073",a.style.borderRadius="10px",a.style.marginRight="12px",a.style.textAlign="center",t.appendChild(a);var o=document.createElement("div");o.style.color="white",o.style.fontSize="16px",o.style.paddingLeft="5px",o.style.paddingRight="5px",o.innerHTML="Directions",a.appendChild(o),a.addEventListener("click",function(){e.getDirections()})}function i(e){return{path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:e,fillOpacity:1,strokeColor:"#000",strokeWeight:1,scale:1}}var s,l=-1,c=0;e.selectedEvent=o.getEventData(),e.targetLocation=e.selectedEvent.destination,e.toggleStartBtn=!0,e.enableTrackBtn="ACCEPTED"==e.selectedEvent.mystatus,e.customisedInviteeList="",e.arrivedPpl=[],e.showAnimation=!1,e.trackingMode=!1;for(var u=e.selectedEvent.inviteeList,g="",d=0;d<u.length;d++){var p=u[d].name;if(1==u.length){e.customisedInviteeList=p;break}if(u.length<=4){if(!u[d+1]){g+=" and "+p,e.customisedInviteeList=g;break}g+=p,u[d+2]&&(g+=", ")}else{if(!(3>=d)){var m=u.length-d;g+=" and "+m+" more",e.customisedInviteeList=g;break}g+=p,3>d&&(g+=", ")}}e.updateSelectedEventStatus=function(){var t=e.selectedEvent;"ACCEPTED"==t.mystatus?t.statusClass="accepted":"PENDING"==t.mystatus?t.statusClass="pending":t.statusClass="rejected";var n=new Date(t.eventDate),a=new Date;n.getDate()==a.getDate()&&n.getMonth()==a.getMonth()&&n.getFullYear()==a.getFullYear()?t.eventDate="Today":t.eventDate=n},e.updateSelectedEventStatus();var v=function(t){e.userList=t,e.currentUser=o.getCurrentUser(),e.updateCurrentUserPosition(),e.getCoordinates()},h=function(t){e.userList=t};a.getData().then(v,h);var f,k,b,C=new google.maps.Map(document.getElementById("map"),{center:e.targetLocation,scrollwheel:!0,zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0}),L=(new google.maps.Marker({position:e.targetLocation,map:C}),document.createElement("div"));L.style.padding="0px 0px 20px 0px";new r(L,C);C.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(L),e.updateCurrentUserPosition=function(){f=new MarkerWithLabel({position:e.currentUser.source,map:C,labelContent:"You",labelAnchor:new google.maps.Point(10,45),labelClass:"labels",labelInBackground:!1,icon:i("#00387B")})},e.getCoordinates=function(){var t=e.userList,n=e.currentUser;t.forEach(function(a,o){k=new google.maps.DirectionsRenderer({map:C,suppressMarkers:!0});var r={origin:t[o].source,destination:e.targetLocation,travelMode:google.maps.TravelMode.DRIVING};b=new google.maps.DirectionsService,b.route(r,function(a,r){r==google.maps.DirectionsStatus.OK&&(n.source.lat==a.request.origin.lat&&n.source.lng==a.request.origin.lng&&(e.currentUser.route=a),t[o].destination=e.targetLocation,t[o].positions=a.routes[0].overview_path)})})},e.updateUserPosition=function(){var n=e.userList,a=e.targetLocation;n.forEach(function(o,r){var u=o,g=u.positions;if(g[l]){var d=g[l].lat(),p=g[l].lng(),m=new google.maps.LatLng(d,p);if(u.marker)u.marker.setPosition(m);else if(u.id==e.currentUser.id)u.marker=new MarkerWithLabel({position:m,map:C,labelContent:"You",labelAnchor:new google.maps.Point(10,45),labelClass:"labels",labelInBackground:!1,icon:i("#00387B")});else{var v=u.name.split(" "),h=v.length>1?v[0].charAt(0)+v[1].charAt(0):v[0].charAt(0);u.marker=new MarkerWithLabel({position:m,map:C,labelContent:h,labelAnchor:new google.maps.Point(10,45),labelClass:"labels",labelInBackground:!1,icon:i("#493073")})}}else if(a.lat===u.destination.lat&&a.lng===u.destination.lng&&!u.reached){u.reached=!0,c++;var v=u.name.split(" "),h=v.length>1?v[0].charAt(0)+v[1].charAt(0):v[0].charAt(0),f={name:u.name,label:h};e.arrivedPpl.push(f),u.marker.setMap(null),c==n.length&&(e.showAnimation=!0,e.trackingMode=!1,e.enableTrackBtn=!1,l=-1,t.cancel(s))}})},e.trackUserPosition=function(){s=t(function(){l++,e.updateUserPosition()},1e3)},e.stopTracking=function(){l=-1,t.cancel(s),e.userList.forEach(function(e,t){e.marker.setMap(null),e.marker=null,e.reached=null}),c=0,e.showAnimation=!1,e.trackingMode=!1,e.arrivedPpl=[],e.toggleStartBtn=!0,e.updateCurrentUserPosition()},e.trackUsers=function(){var t=document.getElementById("mapdirectionBtn");t&&(t.style.display="none"),k.setMap(null),f.setMap(null),e.trackingMode=!0,e.toggleStartBtn=!1,e.trackUserPosition()},e.getDirections=function(){k.setDirections(e.currentUser.route)}});